import com.jemstep.model.BusinessEntityModel
import com.jemstep.model.CustomModel.{CacheHolder, EntityHolder}
import com.jemstep.model.ExtractorModel.IncomingData
import com.jemstep.model.{BusinessModel, ExtractorModel}
import org.specs2.mutable.Specification
class  ExtractionTest extends Specification with DependencyTest {

  val cache = scala.collection.mutable.Map.empty[String, CacheHolder]

  val UserIdentifiedjson ="""{"userId": "e37f6d0b-0df2-417b-a2da-10a92e2381e2", "externalId": "8e63a075-eb83-4cb4-b3cb-82884b16b2b2", "organizationId": "nextgenbigorg", "username": {"plainValue": {"value": "yellowtiger688", "isCaseSensitive": false}}, "firstName": {"plainValue": "????"}, "lastName": {"plainValue": "?????"}, "emailAddress": {"plainValue": "yellowtiger688@example.com"}, "lastLogin": "2018-10-05T11:11:02.029Z", "userStatus": {"lastIssueDate": "2018-10-05T11:11:02.029Z", "userSince": "2010-07-04T09:24:42.000Z", "registeredForAggr": false, "lastAggregation": null, "lastManualUpdate": null, "billingState": "BILLING_FREE", "userFlowStatus": {"hasGoal": false, "hasPortfolio": false, "viewedAssetAllocation": false, "viewedActionPlan": false, "hasCompletedSandboxGoal": false, "signingCeremonyInProgress": false}}, "accessMeta": {"clientAddr": "192.168.1.1", "remoteAddr": "192.168.1.1", "userAgent": "Mozilla/5.0 (Macintosh; Intel Mac OS X x.y; rv:42.0) Gecko/20100101 Firefox/42.0", "proto": "https", "host": "nextgenbigorg.jemstep.com", "uri": "/", "method": "GET", "referrer": "none"}, "seoCampaign": {"source": "source", "campaign": "campaign", "medium": "medium", "keyword": "keyword", "adContent": "adContent", "adClickId": "adClickId"}}"""
  val recordSchemaFullName1 = "com.jemstep.model.events.shared.UserIdentified"
  val userId1 = "001"
  val organizationId1 = "nextgenbank"
  val operation1 = "UPSERT"
  val record_offset1: Long = 1
  val incomingData1: IncomingData =
    IncomingData(recordSchemaFullName1,
      UserIdentifiedjson,
      userId1,
      organizationId1,
      operation1,
      record_offset1)

  val businessData1: BusinessModel = ExtractorModel.parser(incomingData1)
  val listOfEntity1: List[BusinessEntityModel.EntityModel] = businessData1.extractEntityModels(incomingData1.userId, incomingData1.organizationId, incomingData1.operation)
  listOfEntity1.map(a => println(s"JSON: 'UserIdentified', entity : ${a.entityType}, Number of Records :  ${a.jsonObj.length}\n$a\n"))
  listOfEntity1.map(entityModel => EntityHolder(incomingData1.offSet, entityModel)).map(x => NewCacheActor_actor(cache, x))


  val ModelQuestionnairejson ="""{"questions": [{"questionId": "incomeTaxRate", "answer": "62.36"}, {"questionId": "netWorth", "answer": "8"}], "pendingEdition": []}"""
  val recordSchemaFullName2 = "com.jemstep.model.questionnaire.ModelQuestionnaire"
  val userId2 = "002"
  val organizationId2 = "nextgenbank"
  val operation2 = "UPSERT"
  val record_offset2: Long = 1
  val incomingData2: IncomingData =
    IncomingData(recordSchemaFullName2,
      ModelQuestionnairejson,
      userId2,
      organizationId2,
      operation2,
      record_offset2)

  val businessData2: BusinessModel = ExtractorModel.parser(incomingData2)
  val listOfEntity2: List[BusinessEntityModel.EntityModel] = businessData2.extractEntityModels(incomingData2.userId, incomingData2.organizationId, incomingData2.operation)
  listOfEntity2.map(a => println(s"JSON: 'ModelQuestionnaire', entity : ${a.entityType}, Number of Records :  ${a.jsonObj.length}\n$a\n"))
  listOfEntity2.map(entityModel => EntityHolder(incomingData2.offSet, entityModel)).map(x => NewCacheActor_actor(cache, x))



  val Goaljson ="""{"id": "5bb746c6e4b00d9a9d48b6a9", "goalObjective": "EMERGENCY", "goalType": "MAIN", "properties": {"goalName": "Emergency Fund Goal", "created": "2010-07-04T09:24:42.000Z", "updated": "2018-10-05T11:11:02.030Z"}, "questionnaire": {"questions": [{"questionId": "riskRelatedToInvestment", "answer": "I understand that some level of risk is part of the investing process."}, {"questionId": "timeFrameObjective", "answer": "10 to 15 years"}, {"questionId": "timeFrameWithdrawal", "answer": "Not for at least 10 years"}, {"questionId": "withdrawalRequirement", "answer": "2% to 4% per year"}, {"questionId": "investmentAttitude", "answer": "My only goal is to grow the value of the account over time and I am willing to accept reasonable fluctuations in my account value."}, {"questionId": "marketDropReaction", "answer": "Keep all of my investments considering my long-term investment goals and the principle of asset allocation."}, {"questionId": "futureIncomeConfidence", "answer": "Somewhat stable"}], "pendingEdition": []}, "relatedGoalId": null}"""
  val recordSchemaFullName3 = "com.jemstep.model.goal.Goal"
  val userId3 = "003"
  val organizationId3 = "nextgenbank"
  val operation3 = "UPSERT"
  val record_offset3: Long = 1
  val incomingData3: IncomingData =
    IncomingData(recordSchemaFullName3,
      Goaljson,
      userId3,
      organizationId3,
      operation3,
      record_offset3)

  val businessData3: BusinessModel = ExtractorModel.parser(incomingData3)

  val listOfEntity3: List[BusinessEntityModel.EntityModel] = businessData3.extractEntityModels(incomingData3.userId, incomingData3.organizationId, incomingData3.operation)
  listOfEntity3.map(a => println(s"JSON: 'Goal', entity : ${a.entityType}, Number of Records :  ${a.jsonObj.length}\n$a\n"))
  listOfEntity3.map(entityModel => EntityHolder(incomingData3.offSet, entityModel)).map(x => NewCacheActor_actor(cache, x))



  val PortfolioForGoaljson ="""{"goalId": "5bb746c6e4b00d9a9d48b6a8", "portfolioByBroker": {"brokers": [{"name": "Charles Schwab", "aggregation": false, "accounts": [{"accountType": "UgmaUtma", "accountNumber": {"plainValue": "C-26957-5bb746c6e4b00d"}, "accountName": "Charles Schwab Retirement Fund Account 55", "currency": "USD", "accountStatus": "Closed", "totalBalance": 739006.9735750549, "cashBalance": 9799.458372594208, "uuid": "4921cf23-7609-49fc-8f09-b08854bbf673", "goalIds": ["5bb746c6e4b00d9a9d48b6a8"], "dollarValue": 26479.522283668408, "portfolioPercent": 100.0, "positions": [{"ticker": null, "description": "SPDR S&P 500 ETF Trust", "units": 68.87975746230556, "unitPrice": 357.522334735745, "currency": "USD", "costBasis": 100.0, "product": null, "productId": null, "allocations": {"T2_US_LARGE_CAP": 100.0}, "uuid": "5a8761e3-ed32-468e-9018-c95e01f553b0", "update": "2018-10-05T11:11:02.029Z", "created": "2018-10-05T11:11:02.029Z", "dollarValue": 24626.051703955338, "assetClass": null, "portfolioPercent": 0.0, "cusip": null, "assetClassName": {"key": "New Hampshire Municipal Bonds", "args": []}, "purchaseDate": null, "flags": null, "sourceData": null}, {"ticker": null, "description": "SPDR S&P 500 ETF Trust", "units": 13.64178151733756, "unitPrice": 135.8671942779222, "currency": "USD", "costBasis": 100.0, "product": null, "productId": 10516712, "allocations": {"T2_US_LARGE_CAP": 100.0}, "uuid": null, "update": "2018-10-05T11:11:02.029Z", "created": "2018-10-05T11:11:02.029Z", "dollarValue": 1853.4705797130705, "assetClass": null, "portfolioPercent": 0.0, "cusip": null, "assetClassName": {"key": "Tennessee Municipal Bonds", "args": []}, "purchaseDate": null, "flags": null, "sourceData": null}], "update": "2018-10-05T11:11:02.029Z", "created": "2018-10-05T11:11:02.029Z", "error": null, "flags": {"taxable": true, "ignore": true, "lock": false, "lockByDefault": true, "selfDirected": null, "discretionary": true, "enrolled": true}, "ownership": "Individual", "accountIntegrations": {"integrationsEnabled": false, "orion": {"accountId": 5, "registrationId": 10, "clientId": 10, "advisorOverride": {"model": {"id": 5}, "managementStyle": {"id": 5}}, "created": "2018-10-05T11:10:48.476Z"}, "pershing": {"mi": {"state": "PershingMIAwaitingSetup", "currentModel": null, "currentLastUpdated": "2018-10-05T11:10:48.474Z", "pendingModel": "CONSERVATIVE", "pendingSince": "2018-10-05T11:10:48.474Z", "confirmedModel": "AGGRESSIVE", "lastConfirmed": "2018-10-05T11:10:48.474Z"}, "enrollment": {"repCode": "8S3", "accountNumberPrefix": "LOL"}, "edelivery": {"returnCode": 0}}}, "contributionPlan": {"employerName": "Employer, Inc", "employerEin": "ein-ein", "employerId": "323313", "planId": 3, "planName": "Employer, Inc Contribution Plan", "eligibleForRollover": true}, "isRollover": false}, {"accountType": "Plan401K", "accountNumber": {"plainValue": "C-49277-5bb746c6e4b00d"}, "accountName": "Charles Schwab Retirement Fund Account 31", "currency": "USD", "accountStatus": "PendingClose", "totalBalance": 681465.436972036, "cashBalance": 9636.104207498229, "uuid": "fdd145a4-abb8-4ae6-a5fc-4dd12bc19402", "goalIds": ["5bb746c6e4b00d9a9d48b6a8"], "dollarValue": 23801.231135497128, "portfolioPercent": 100.0, "positions": [{"ticker": "SPY", "description": "SPDR S&P 500 ETF Trust", "units": 1.1982770411243293, "unitPrice": 243.200535819269, "currency": "USD", "costBasis": 100.0, "product": null, "productId": 10516712, "allocations": {"T2_US_LARGE_CAP": 100.0}, "uuid": "2bbba559-c81f-4c3e-92c4-355b36c0328c", "update": null, "created": "2018-10-05T11:11:02.029Z", "dollarValue": 291.42161846136514, "assetClass": null, "portfolioPercent": 0.0, "cusip": null, "assetClassName": {"key": "Delaware Municipal Bonds", "args": []}, "purchaseDate": null, "flags": null, "sourceData": null}, {"ticker": "SPY", "description": "SPDR S&P 500 ETF Trust", "units": 52.10345124009213, "unitPrice": 307.60855575050834, "currency": "USD", "costBasis": null, "product": null, "productId": 10516712, "allocations": {"T2_US_LARGE_CAP": 100.0}, "uuid": "b7777a00-efbc-4d21-8c97-ba1720b14b39", "update": "2018-10-05T11:11:02.029Z", "created": "2018-10-05T11:11:02.029Z", "dollarValue": 16027.467385581773, "assetClass": "T3_BOND_US_NON_TAXABLE_IDAHO", "portfolioPercent": 0.0, "cusip": null, "assetClassName": {"key": "Idaho Municipal Bonds", "args": []}, "purchaseDate": "2018-10-05T11:11:02.029Z", "flags": null, "sourceData": null}, {"ticker": "SPY", "description": "SPDR S&P 500 ETF Trust", "units": 46.50242699896643, "unitPrice": 160.90218541970498, "currency": "USD", "costBasis": 100.0, "product": null, "productId": 10516712, "allocations": {"T2_US_LARGE_CAP": 100.0}, "uuid": "8655f697-42b4-4d07-94f3-fef91fa1df0e", "update": null, "created": "2018-10-05T11:11:02.029Z", "dollarValue": 7482.342131453991, "assetClass": null, "portfolioPercent": 0.0, "cusip": "105712", "assetClassName": {"key": "U.S. Mid Cap Stocks", "args": []}, "purchaseDate": null, "flags": null, "sourceData": null}], "update": "2018-10-05T11:11:02.029Z", "created": "2018-10-05T11:11:02.029Z", "error": null, "flags": {"taxable": true, "ignore": true, "lock": false, "lockByDefault": true, "selfDirected": null, "discretionary": true, "enrolled": true}, "ownership": "Individual", "accountIntegrations": {"integrationsEnabled": false, "orion": {"accountId": 5, "registrationId": 10, "clientId": 10, "advisorOverride": {"model": {"id": 5}, "managementStyle": {"id": 5}}, "created": "2018-10-05T11:10:48.476Z"}, "pershing": {"mi": {"state": "PershingMIAwaitingSetup", "currentModel": null, "currentLastUpdated": "2018-10-05T11:10:48.474Z", "pendingModel": "CONSERVATIVE", "pendingSince": "2018-10-05T11:10:48.474Z", "confirmedModel": "AGGRESSIVE", "lastConfirmed": "2018-10-05T11:10:48.474Z"}, "enrollment": {"repCode": "8S3", "accountNumberPrefix": "LOL"}, "edelivery": {"returnCode": 0}}}, "contributionPlan": {"employerName": "Employer, Inc", "employerEin": "ein-ein", "employerId": "323313", "planId": 3, "planName": "Employer, Inc Contribution Plan", "eligibleForRollover": true}, "isRollover": false}, {"accountType": "TaxFreeCertDep", "accountNumber": {"plainValue": "C-9761-5bb746c6e4b00d"}, "accountName": "Charles Schwab Retirement Fund Account 88", "currency": "USD", "accountStatus": "PendingClose", "totalBalance": 32342.73292615364, "cashBalance": 3945.427602411301, "uuid": "acb7f0b5-acd0-46ef-a0f3-dfe83b924176", "goalIds": ["5bb746c6e4b00d9a9d48b6a8"], "dollarValue": 33426.37158956149, "portfolioPercent": 100.0, "positions": [{"ticker": "SPY", "description": "SPDR S&P 500 ETF Trust", "units": 41.306916796321644, "unitPrice": 392.8246023798472, "currency": "USD", "costBasis": 100.0, "product": null, "productId": 10516712, "allocations": {"T2_US_LARGE_CAP": 100.0}, "uuid": "2fd89c71-08e4-4a57-999b-1f45a6652d3a", "update": null, "created": "2018-10-05T11:11:02.030Z", "dollarValue": 16226.37316605248, "assetClass": "T3_BOND_US_NON_TAXABLE_NORTH_DAKOTA", "portfolioPercent": 0.0, "cusip": "105712", "assetClassName": {"key": "North Dakota Municipal Bonds", "args": []}, "purchaseDate": "2018-10-05T11:11:02.030Z", "flags": null, "sourceData": null}, {"ticker": null, "description": "SPDR S&P 500 ETF Trust", "units": 42.594624700801084, "unitPrice": 87.6788171400107, "currency": "USD", "costBasis": 100.0, "product": null, "productId": null, "allocations": {"T2_US_LARGE_CAP": 100.0}, "uuid": "9e9e10de-e56e-4c82-b5f0-a67b630f9afe", "update": null, "created": "2018-10-05T11:11:02.030Z", "dollarValue": 3734.646310288921, "assetClass": null, "portfolioPercent": 0.0, "cusip": null, "assetClassName": {"key": "South Carolina Municipal Bonds", "args": []}, "purchaseDate": "2018-10-05T11:11:02.030Z", "flags": null, "sourceData": null}, {"ticker": null, "description": "SPDR S&P 500 ETF Trust", "units": 50.989365972455325, "unitPrice": 264.0815757641333, "currency": "USD", "costBasis": null, "product": null, "productId": 10516712, "allocations": {"T2_US_LARGE_CAP": 100.0}, "uuid": "f58dadf2-4a44-4fa2-b125-b21061f5be39", "update": null, "created": "2018-10-05T11:11:02.030Z", "dollarValue": 13465.35211322008, "assetClass": null, "portfolioPercent": 0.0, "cusip": "105712", "assetClassName": {"key": "U.S. Mid Cap Stocks", "args": []}, "purchaseDate": "2018-10-05T11:11:02.030Z", "flags": null, "sourceData": null}], "update": "2018-10-05T11:11:02.030Z", "created": "2018-10-05T11:11:02.030Z", "error": null, "flags": {"taxable": true, "ignore": true, "lock": false, "lockByDefault": true, "selfDirected": null, "discretionary": true, "enrolled": true}, "ownership": "Individual", "accountIntegrations": {"integrationsEnabled": false, "orion": {"accountId": 5, "registrationId": 10, "clientId": 10, "advisorOverride": {"model": {"id": 5}, "managementStyle": {"id": 5}}, "created": "2018-10-05T11:10:48.476Z"}, "pershing": {"mi": {"state": "PershingMIAwaitingSetup", "currentModel": null, "currentLastUpdated": "2018-10-05T11:10:48.474Z", "pendingModel": "CONSERVATIVE", "pendingSince": "2018-10-05T11:10:48.474Z", "confirmedModel": "AGGRESSIVE", "lastConfirmed": "2018-10-05T11:10:48.474Z"}, "enrollment": {"repCode": "8S3", "accountNumberPrefix": "LOL"}, "edelivery": {"returnCode": 0}}}, "contributionPlan": {"employerName": "Employer, Inc", "employerEin": "ein-ein", "employerId": "323313", "planId": 3, "planName": "Employer, Inc Contribution Plan", "eligibleForRollover": true}, "isRollover": null}, {"accountType": "Mppp", "accountNumber": {"plainValue": "C-16476-5bb746c6e4b00d"}, "accountName": "Charles Schwab Retirement Fund Account 23", "currency": "USD", "accountStatus": "PendingClose", "totalBalance": 561088.7261078098, "cashBalance": 6022.436897553479, "uuid": "1b5ac70b-0fee-4205-a25c-592c43ac0d68", "goalIds": ["5bb746c6e4b00d9a9d48b6a8"], "dollarValue": 13671.374570445618, "portfolioPercent": 100.0, "positions": [{"ticker": null, "description": "SPDR S&P 500 ETF Trust", "units": 99.54205215832641, "unitPrice": 137.3427036515245, "currency": "USD", "costBasis": 100.0, "product": "Index", "productId": 10516712, "allocations": {"T2_US_LARGE_CAP": 100.0}, "uuid": null, "update": "2018-10-05T11:11:02.030Z", "created": "2018-10-05T11:11:02.030Z", "dollarValue": 13671.374570445618, "assetClass": "T3_BOND_US_NON_TAXABLE_WASHINGTON", "portfolioPercent": 0.0, "cusip": null, "assetClassName": {"key": "Washington Municipal Bonds", "args": []}, "purchaseDate": null, "flags": null, "sourceData": null}], "update": "2018-10-05T11:11:02.030Z", "created": "2018-10-05T11:11:02.030Z", "error": null, "flags": {"taxable": true, "ignore": true, "lock": false, "lockByDefault": true, "selfDirected": null, "discretionary": true, "enrolled": true}, "ownership": "Individual", "accountIntegrations": {"integrationsEnabled": false, "orion": {"accountId": 5, "registrationId": 10, "clientId": 10, "advisorOverride": {"model": {"id": 5}, "managementStyle": {"id": 5}}, "created": "2018-10-05T11:10:48.476Z"}, "pershing": {"mi": {"state": "PershingMIAwaitingSetup", "currentModel": null, "currentLastUpdated": "2018-10-05T11:10:48.474Z", "pendingModel": "CONSERVATIVE", "pendingSince": "2018-10-05T11:10:48.474Z", "confirmedModel": "AGGRESSIVE", "lastConfirmed": "2018-10-05T11:10:48.474Z"}, "enrollment": {"repCode": "8S3", "accountNumberPrefix": "LOL"}, "edelivery": {"returnCode": 0}}}, "contributionPlan": {"employerName": "Employer, Inc", "employerEin": "ein-ein", "employerId": "323313", "planId": 3, "planName": "Employer, Inc Contribution Plan", "eligibleForRollover": true}, "isRollover": null}], "url": "https://www.schwab.co", "hasImage": true, "uuid": "9c0402c5-7b68-49a0-8602-99c369c4b3a9", "dollarValue": 97378.49957917264, "portfolioPercent": 56.407057709009436, "update": "2018-10-05T11:11:02.030Z", "created": "2018-10-05T11:11:02.030Z", "fiId": 3, "error": null, "showErrorAlert": null, "flags": null}, {"name": "E*Trade Financial", "aggregation": true, "accounts": [{"accountType": "IRA", "accountNumber": {"plainValue": "E-7226-5bb746c6e4b00d"}, "accountName": "E*Trade Financial Retirement Fund Account 45", "currency": "USD", "accountStatus": "Closed", "totalBalance": 655062.3200640628, "cashBalance": 7493.491072719379, "uuid": "d87cc6ca-6e4a-4f1e-b8b6-28ea689beeb4", "goalIds": ["5bb746c6e4b00d9a9d48b6a8"], "dollarValue": 7030.634857233056, "portfolioPercent": 100.0, "positions": [{"ticker": "SPY", "description": "SPDR S&P 500 ETF Trust", "units": 55.194822095417194, "unitPrice": 127.37852193959344, "currency": "USD", "costBasis": null, "product": null, "productId": null, "allocations": {"T2_US_LARGE_CAP": 100.0}, "uuid": null, "update": "2018-10-05T11:11:02.030Z", "created": "2018-10-05T11:11:02.030Z", "dollarValue": 7030.634857233056, "assetClass": "T3_BOND_US_NON_TAXABLE_WYOMING", "portfolioPercent": 0.0, "cusip": "105712", "assetClassName": {"key": "Wyoming Municipal Bonds", "args": []}, "purchaseDate": "2018-10-05T11:11:02.030Z", "flags": null, "sourceData": null}], "update": "2018-10-05T11:11:02.030Z", "created": "2018-10-05T11:11:02.030Z", "error": null, "flags": {"taxable": true, "ignore": true, "lock": false, "lockByDefault": true, "selfDirected": null, "discretionary": true, "enrolled": true}, "ownership": "Individual", "accountIntegrations": {"integrationsEnabled": false, "orion": {"accountId": 5, "registrationId": 10, "clientId": 10, "advisorOverride": {"model": {"id": 5}, "managementStyle": {"id": 5}}, "created": "2018-10-05T11:10:48.476Z"}, "pershing": {"mi": {"state": "PershingMIAwaitingSetup", "currentModel": null, "currentLastUpdated": "2018-10-05T11:10:48.474Z", "pendingModel": "CONSERVATIVE", "pendingSince": "2018-10-05T11:10:48.474Z", "confirmedModel": "AGGRESSIVE", "lastConfirmed": "2018-10-05T11:10:48.474Z"}, "enrollment": {"repCode": "8S3", "accountNumberPrefix": "LOL"}, "edelivery": {"returnCode": 0}}}, "contributionPlan": {"employerName": "Employer, Inc", "employerEin": "ein-ein", "employerId": "323313", "planId": 3, "planName": "Employer, Inc Contribution Plan", "eligibleForRollover": true}, "isRollover": null}, {"accountType": "Annuity", "accountNumber": {"plainValue": "E-27282-5bb746c6e4b00d"}, "accountName": "E*Trade Financial Retirement Fund Account 76", "currency": "USD", "accountStatus": "UnderDiscretion", "totalBalance": 732382.6736174308, "cashBalance": 5544.913715541262, "uuid": "41649991-dd4e-44bb-b66c-bb679e61956b", "goalIds": ["5bb746c6e4b00d9a9d48b6a8"], "dollarValue": 1387.0015447805179, "portfolioPercent": 100.0, "positions": [{"ticker": null, "description": "SPDR S&P 500 ETF Trust", "units": 91.51261591398703, "unitPrice": 15.15639708173313, "currency": "USD", "costBasis": 100.0, "product": null, "productId": null, "allocations": {"T2_US_LARGE_CAP": 100.0}, "uuid": null, "update": "2018-10-05T11:11:02.030Z", "created": "2018-10-05T11:11:02.030Z", "dollarValue": 1387.0015447805179, "assetClass": "T3_STOCK_SECTOR_ENERGY", "portfolioPercent": 0.0, "cusip": "105712", "assetClassName": {"key": "Energy Stocks", "args": []}, "purchaseDate": null, "flags": null, "sourceData": null}], "update": "2018-10-05T11:11:02.030Z", "created": "2018-10-05T11:11:02.030Z", "error": null, "flags": {"taxable": true, "ignore": true, "lock": false, "lockByDefault": true, "selfDirected": null, "discretionary": true, "enrolled": true}, "ownership": "Individual", "accountIntegrations": {"integrationsEnabled": false, "orion": {"accountId": 5, "registrationId": 10, "clientId": 10, "advisorOverride": {"model": {"id": 5}, "managementStyle": {"id": 5}}, "created": "2018-10-05T11:10:48.476Z"}, "pershing": {"mi": {"state": "PershingMIAwaitingSetup", "currentModel": null, "currentLastUpdated": "2018-10-05T11:10:48.474Z", "pendingModel": "CONSERVATIVE", "pendingSince": "2018-10-05T11:10:48.474Z", "confirmedModel": "AGGRESSIVE", "lastConfirmed": "2018-10-05T11:10:48.474Z"}, "enrollment": {"repCode": "8S3", "accountNumberPrefix": "LOL"}, "edelivery": {"returnCode": 0}}}, "contributionPlan": {"employerName": "Employer, Inc", "employerEin": "ein-ein", "employerId": "323313", "planId": 3, "planName": "Employer, Inc Contribution Plan", "eligibleForRollover": true}, "isRollover": null}, {"accountType": "Other", "accountNumber": {"plainValue": "E-81086-5bb746c6e4b00d"}, "accountName": "E*Trade Financial Retirement Fund Account 94", "currency": "USD", "accountStatus": "TransferPending", "totalBalance": 801007.0510289462, "cashBalance": 2200.823618347536, "uuid": "7e17750c-c79a-4712-9f4c-6f5180e7828e", "goalIds": ["5bb746c6e4b00d9a9d48b6a8"], "dollarValue": 7588.8194178717395, "portfolioPercent": 100.0, "positions": [{"ticker": "SPY", "description": "SPDR S&P 500 ETF Trust", "units": 97.08390080005256, "unitPrice": 55.49063136200374, "currency": "USD", "costBasis": 100.0, "product": "Stock", "productId": 10516712, "allocations": {"T2_US_LARGE_CAP": 100.0}, "uuid": "dabc860b-9e75-4ca7-9bc4-0da5df2e9f8d", "update": null, "created": "2018-10-05T11:11:02.030Z", "dollarValue": 5387.246950481057, "assetClass": "T3_BOND_US_DIVERSIFIED", "portfolioPercent": 0.0, "cusip": null, "assetClassName": {"key": "U.S. Diversified Bonds", "args": []}, "purchaseDate": "2018-10-05T11:11:02.030Z", "flags": null, "sourceData": null}, {"ticker": null, "description": "SPDR S&P 500 ETF Trust", "units": 9.806830324005322, "unitPrice": 224.49378592812366, "currency": "USD", "costBasis": 100.0, "product": null, "productId": null, "allocations": {"T2_US_LARGE_CAP": 100.0}, "uuid": null, "update": null, "created": "2018-10-05T11:11:02.030Z", "dollarValue": 2201.5724673906825, "assetClass": "T3_BOND_US_NON_TAXABLE_WASHINGTON", "portfolioPercent": 0.0, "cusip": null, "assetClassName": {"key": "Washington Municipal Bonds", "args": []}, "purchaseDate": "2018-10-05T11:11:02.030Z", "flags": null, "sourceData": null}], "update": "2018-10-05T11:11:02.030Z", "created": "2018-10-05T11:11:02.030Z", "error": null, "flags": {"taxable": true, "ignore": true, "lock": false, "lockByDefault": true, "selfDirected": null, "discretionary": true, "enrolled": true}, "ownership": "Individual", "accountIntegrations": {"integrationsEnabled": false, "orion": {"accountId": 5, "registrationId": 10, "clientId": 10, "advisorOverride": {"model": {"id": 5}, "managementStyle": {"id": 5}}, "created": "2018-10-05T11:10:48.476Z"}, "pershing": {"mi": {"state": "PershingMIAwaitingSetup", "currentModel": null, "currentLastUpdated": "2018-10-05T11:10:48.474Z", "pendingModel": "CONSERVATIVE", "pendingSince": "2018-10-05T11:10:48.474Z", "confirmedModel": "AGGRESSIVE", "lastConfirmed": "2018-10-05T11:10:48.474Z"}, "enrollment": {"repCode": "8S3", "accountNumberPrefix": "LOL"}, "edelivery": {"returnCode": 0}}}, "contributionPlan": {"employerName": "Employer, Inc", "employerEin": "ein-ein", "employerId": "323313", "planId": 3, "planName": "Employer, Inc Contribution Plan", "eligibleForRollover": true}, "isRollover": null}, {"accountType": "MutualFund", "accountNumber": {"plainValue": "E-47968-5bb746c6e4b00d"}, "accountName": "E*Trade Financial Retirement Fund Account 12", "currency": "USD", "accountStatus": "PendingClose", "totalBalance": 177036.2889486654, "cashBalance": 5751.591939163985, "uuid": "9ae1179c-1b9b-427b-984f-e11472d1f31e", "goalIds": ["5bb746c6e4b00d9a9d48b6a8"], "dollarValue": 39336.77130782808, "portfolioPercent": 100.0, "positions": [{"ticker": null, "description": "SPDR S&P 500 ETF Trust", "units": 86.40075104708797, "unitPrice": 150.37932634553113, "currency": "USD", "costBasis": 100.0, "product": "CertDep", "productId": null, "allocations": {"T2_US_LARGE_CAP": 100.0}, "uuid": "bbd99ec7-fcb8-4559-ac20-70ce1f37097d", "update": null, "created": "2018-10-05T11:11:02.030Z", "dollarValue": 12992.886738209032, "assetClass": "T3_STOCK_SECTOR_TELECOMS", "portfolioPercent": 0.0, "cusip": null, "assetClassName": {"key": "Telecommunication Stocks", "args": []}, "purchaseDate": null, "flags": null, "sourceData": null}, {"ticker": null, "description": "SPDR S&P 500 ETF Trust", "units": 92.70168439989519, "unitPrice": 181.01184131953784, "currency": "USD", "costBasis": 100.0, "product": null, "productId": 10516712, "allocations": {"T2_US_LARGE_CAP": 100.0}, "uuid": "8af7114e-70ff-44a6-8251-1660224fd68d", "update": null, "created": "2018-10-05T11:11:02.030Z", "dollarValue": 16780.102586647703, "assetClass": null, "portfolioPercent": 0.0, "cusip": null, "assetClassName": {"key": "Texas Municipal Bonds", "args": []}, "purchaseDate": null, "flags": null, "sourceData": null}, {"ticker": "SPY", "description": "SPDR S&P 500 ETF Trust", "units": 25.361209424218746, "unitPrice": 377.1027565364604, "currency": "USD", "costBasis": null, "product": "Stock", "productId": 10516712, "allocations": {"T2_US_LARGE_CAP": 100.0}, "uuid": null, "update": "2018-10-05T11:11:02.030Z", "created": "2018-10-05T11:11:02.030Z", "dollarValue": 9563.781982971346, "assetClass": "T3_BOND_US_NON_TAXABLE_OKLAHOMA", "portfolioPercent": 0.0, "cusip": "105712", "assetClassName": {"key": "Oklahoma Municipal Bonds", "args": []}, "purchaseDate": null, "flags": null, "sourceData": null}], "update": "2018-10-05T11:11:02.030Z", "created": "2018-10-05T11:11:02.030Z", "error": null, "flags": {"taxable": true, "ignore": true, "lock": false, "lockByDefault": true, "selfDirected": null, "discretionary": true, "enrolled": true}, "ownership": "Individual", "accountIntegrations": {"integrationsEnabled": false, "orion": {"accountId": 5, "registrationId": 10, "clientId": 10, "advisorOverride": {"model": {"id": 5}, "managementStyle": {"id": 5}}, "created": "2018-10-05T11:10:48.476Z"}, "pershing": {"mi": {"state": "PershingMIAwaitingSetup", "currentModel": null, "currentLastUpdated": "2018-10-05T11:10:48.474Z", "pendingModel": "CONSERVATIVE", "pendingSince": "2018-10-05T11:10:48.474Z", "confirmedModel": "AGGRESSIVE", "lastConfirmed": "2018-10-05T11:10:48.474Z"}, "enrollment": {"repCode": "8S3", "accountNumberPrefix": "LOL"}, "edelivery": {"returnCode": 0}}}, "contributionPlan": {"employerName": "Employer, Inc", "employerEin": "ein-ein", "employerId": "323313", "planId": 3, "planName": "Employer, Inc Contribution Plan", "eligibleForRollover": true}, "isRollover": false}], "url": "https://us.etrade.com/home", "hasImage": false, "uuid": "ae3a3d79-4988-4cda-ab4c-339259ec5dd6", "dollarValue": 55343.22712771339, "portfolioPercent": 43.592942290990564, "update": "2018-10-05T11:11:02.030Z", "created": "2018-10-05T11:11:02.030Z", "fiId": 3, "error": null, "showErrorAlert": false, "flags": null}], "dollarValue": 152721.72670688602, "portfolioPercent": 100.0}}"""
  val recordSchemaFullName4 = "com.jemstep.model.goal.PortfolioForGoal"
  val userId4 = "004"
  val organizationId4 = "nextgenbank"
  val operation4 = "UPSERT"
  val record_offset4: Long = 4
  val incomingData4: IncomingData =
    IncomingData(recordSchemaFullName4,
      PortfolioForGoaljson,
      userId4,
      organizationId4,
      operation4,
      record_offset4)

  val businessData4: BusinessModel = ExtractorModel.parser(incomingData4)
  //println(businessData4)
  val listOfEntity4: List[BusinessEntityModel.EntityModel] = businessData4.extractEntityModels(incomingData4.userId, incomingData4.organizationId, incomingData4.operation)
  listOfEntity4.map(a => println(s"JSON: 'PortfolioForGoal', entity : ${a.entityType}, Number of Records :  ${a.jsonObj.length}\n$a\n"))
  listOfEntity4.map(entityModel => EntityHolder(incomingData4.offSet, entityModel)).map(x => NewCacheActor_actor(cache, x))


  val BacktestMetricsjson ="""{"currentAnnualizedReturn": 7.3399390988397695, "targetAnnualizedReturn": 0.6550467789489911, "currentBestYearPercentage": 11.996195334443232, "currentBestYear": 2017, "targetBestYearPercentage": 18.538412873711852, "targetBestYear": 2017, "currentWorstYearPercentage": 15.698050370754268, "currentWorstYear": 2016, "targetWorstYearPercentage": 16.951819888845556, "targetWorstYear": 2016, "currentYearsWithLosses": -254871436, "targetYearsWithLosses": -367729690, "currentExpenseRatio": 17.428004107161737, "costOfFeesOnCurrentPortfolio": 15.905308921925368, "targetExpenseRatio": 7.063130708872349, "costOfFeesOnTargetPortfolio": 7.13617406967983, "opportunityFeeSaving20Yrs": 0.0, "actualFeeSavingAnnual": 0.0, "actualFeeSaving15Yrs": 0.0}"""
  val recordSchemaFullName5 = "com.jemstep.model.assetliability.BacktestMetrics"
  val userId5 = "005"
  val organizationId5 = "nextgenbank"
  val operation5 = "UPSERT"
  val record_offset5: Long = 1
  val incomingData5: IncomingData =
    IncomingData(recordSchemaFullName5,
      BacktestMetricsjson,
      userId5,
      organizationId5,
      operation5,
      record_offset5)

  val businessData5: BusinessModel = ExtractorModel.parser(incomingData5)

  val listOfEntity5: List[BusinessEntityModel.EntityModel] = businessData5.extractEntityModels(incomingData5.userId, incomingData5.organizationId, incomingData5.operation)
  listOfEntity5.map(a => println(s"JSON: 'BacktestMetrics', entity : ${a.entityType}, Number of Records :  ${a.jsonObj.length}\n$a\n"))
  listOfEntity5.map(entityModel => EntityHolder(incomingData5.offSet, entityModel)).map(x => NewCacheActor_actor(cache, x))


  val TargetForGoaljson ="""{"goalId": "5bb746c6e4b00d9a9d48b6a8", "targetDate": "2030-07-04T09:24:42.000Z", "targetValue": 152722000, "targetModel": {"id": "Conservative", "name": "Conservative", "riskCategory": "LOW_RISK_LOW_RETURN", "riskScoreTopRange": 20.0, "allocations": [{"ticker": "AAPL", "name": "Apple, Inc", "productId": null, "proxyProductId": 1234567, "allocation": {"value": 100.0}, "expenseRatio": {"value": 2.0}, "t2AssetAllocation": {}}], "investmentMinimum": null, "capitalMarketAssumptions": {"cmaReturn": 0.0, "cmaRisk": 0.0}}, "riskScore": {"score": 1.9750418521475854}}"""
  val recordSchemaFullName6 = "com.jemstep.model.goal.TargetForGoal"
  val userId6 = "006"
  val organizationId6 = "nextgenbank"
  val operation6 = "UPSERT"
  val record_offset6: Long = 1
  val incomingData6: IncomingData =
    IncomingData(recordSchemaFullName6,
      TargetForGoaljson,
      userId6,
      organizationId6,
      operation6,
      record_offset6)

  val businessData6: BusinessModel = ExtractorModel.parser(incomingData6)

  val listOfEntity6: List[BusinessEntityModel.EntityModel] = businessData6.extractEntityModels(incomingData6.userId, incomingData6.organizationId, incomingData6.operation)
  listOfEntity6.map(a => println(s"JSON: 'TargetForGoal', entity : ${a.entityType}, Number of Records :  ${a.jsonObj.length}\n$a\n"))
  listOfEntity6.map(entityModel => EntityHolder(incomingData6.offSet, entityModel)).map(x => NewCacheActor_actor(cache, x))


  val AccountholdingDetailsjson =
    """{"primary": {"firstName": {"plainValue": "????"}, "lastName": {"plainValue": "?????"}, "socialSecurity": {"ssn": {"plainValue": "667635925"}, "verified": true}, "email": {"plainValue": "yellowtiger688@example.com"}, "optionalFields": {"prefix": "Mr", "middleName": null, "suffix": "Sr", "dateOfBirth": {"plainValue": "2018-10-05T11:11:02.030Z"}, "maritalStatus": {"plainValue": "Single"}, "numberOfDependents": 1, "gender": null, "relationshipToPrimaryOwner": "Mother-in-law", "identityInformation": null, "contactInformation": {"daytimePhoneNumber": {"plainValue": "3225888979"}, "isInternationalNumber": true, "homeAddress": {"addressLine1": {"plainValue": "8925 ???? ????? ?????"}, "addressLine2": null, "city": {"plainValue": "?????"}, "state": {"plainValue": "VirginIslandsUS"}, "zipCode": {"plainValue": "16068"}, "country": {"plainValue": "Kiribati"}}, "differentMailingAddress": false, "mailingAddress": null, "addressSameAsPrimary": false}, "employmentInformation": null, "sourceOFundsInfo": null, "financialAndTaxInformation": null, "objectiveAndInvestmentDetails": {"primaryInvestmentObjectives": "Long-term growth", "retirementInformation": {"retirementAge": 2, "retirementPlanCoverage": "Yes, by a 401k", "spouseRetirementPlanCoverage": null}}, "investmentKnowledgeInformation": null, "taxDispositionInformation": {"mutualFunds": "FI", "stockDividendsRetirementPlan": "FI", "allOtherSecurities": "FI"}, "personalAffiliations": null, "citizenshipInformation": {"countryOfCitizenship": "St. Vincent and The Grenadines", "countryOfPermanentResidence": "Vietnam", "citizenshipStatus": "Non-U.S. Citizen"}, "securityQuestions": {"questions": [{"questionId": "incomeTaxRate", "answer": "58.18"}, {"questionId": "netWorth", "answer": "09"}], "pendingEdition": []}, "trustedContactDetails": {"trustedContacts": [{"acctUUID": ["e37f6d0b-0df2-417b-a2da-10a92e2381e2", "a37877f9-d8f5-480d-ae93-a5603cbebe95"], "firstName": {"plainValue": "????"}, "lastName": {"plainValue": "?????"}, "email": {"plainValue": "yellowtiger688@example.com"}, "countryOfCitizenship": "Bolivia", "daytimePhoneNumber": "6762596582", "isInternationalNumber": false, "homeAddress": {"addressLine1": {"plainValue": "8925 ???? ????? ?????"}, "addressLine2": null, "city": {"plainValue": "?????"}, "state": {"plainValue": "DistrictOfColumbia"}, "zipCode": {"plainValue": "89337"}, "country": null}, "differentMailingAddress": true, "mailingAddress": {"addressLine1": {"plainValue": "8925 ???? ????? ?????"}, "addressLine2": {"plainValue": "?????? ? ????????"}, "city": {"plainValue": "?????"}, "state": {"plainValue": "Delaware"}, "zipCode": {"plainValue": "10254"}, "country": null}}]}}}, "spouse": null, "primaryBeneficiaryDetails": {"specifyBeneficiariesPerAccount": false, "accountBeneficiaryDetails": [{"acctTypeOwnership": {"acctType": "acctType.name.Plan457", "ownership": "CommunityProperty"}, "fromAcctUUID": null, "accountName": "????? yellowtiger688 8925 ???? ????? ?????  Kathmandu", "brokerName": null, "beneficiaries": [{"beneficiaryType": "Primary", "beneficiaryRole": null, "firstName": {"plainValue": "Spouse"}, "lastName": {"plainValue": "?????"}, "gender": {"plainValue": "Female"}, "socialSecurity": {"plainValue": "787108447"}, "dateOfBirth": {"plainValue": "2018-10-05T11:11:02.030Z"}, "relationship": "Mother-in-law", "sharePercentage": 56.8, "phoneNumber": {"plainValue": "3799087503"}, "isInternationalNumber": false, "homeAddress": {"addressLine1": {"plainValue": "8925 ???? ????? ?????"}, "addressLine2": null, "city": {"plainValue": "?????"}, "state": {"plainValue": "Vermont"}, "zipCode": {"plainValue": "34119"}, "country": {"plainValue": "Slovakia"}}, "perStirpes": true}], "trustBeneficiaries": [{"beneficiaryType": "Primary", "beneficiaryRole": "Person", "trustName": "yellowtiger688", "socialSecurity": {"plainValue": "066308694"}, "dateOfTrust": "2018-10-05T11:11:02.030Z", "sharePercentage": 32.67, "phoneNumber": {"plainValue": "7014404297"}, "isInternationalNumber": false, "homeAddress": {"addressLine1": {"plainValue": "8925 ???? ????? ?????"}, "addressLine2": null, "city": {"plainValue": "?????"}, "state": {"plainValue": "Nebraska"}, "zipCode": {"plainValue": "17604"}, "country": null}}], "otherBeneficiaries": [{"beneficiaryType": "Primary", "beneficiaryRole": "Other non-person", "entityName": "IR mrs ?????? ? ????????", "sharePercentage": 51.7, "phoneNumber": {"plainValue": "7427674007"}, "isInternationalNumber": false, "homeAddress": {"addressLine1": {"plainValue": "8925 ???? ????? ?????"}, "addressLine2": {"plainValue": "?????? ? ????????"}, "city": {"plainValue": "?????"}, "state": {"plainValue": "SouthCarolina"}, "zipCode": {"plainValue": "29220"}, "country": null}}], "perStirpesResponsibleIndividualName": "mrs ???? ?????"}], "maybeSpousalConsentDetails": {"spouseName": "Spouse", "spouseEmail": {"plainValue": "yellowtiger688@spouse.io"}}}, "spouseBeneficiaryDetails": null}"""

  val recordSchemaFullName7 = "com.jemstep.model.enrollment.AccountHolderDetails"
  val userId7 = "007"
  val organizationId7 = "nextgenbank"
  val operation7 = "UPSERT"
  val record_offset7: Long = 1
  val incomingData7: IncomingData =
    IncomingData(recordSchemaFullName7,
      AccountholdingDetailsjson,
      userId7,
      organizationId7,
      operation7,
      record_offset7)

  val businessData7: BusinessModel = ExtractorModel.parser(incomingData7)

  val listOfEntity7: List[BusinessEntityModel.EntityModel] = businessData7.extractEntityModels(incomingData7.userId, incomingData7.organizationId, incomingData7.operation)
  listOfEntity7.map(a => println(s"JSON: 'AccountHolderDetails', entity : ${a.entityType}, Number of Records :  ${a.jsonObj.length}\n$a\n"))
  listOfEntity7.map(entityModel => EntityHolder(incomingData7.offSet, entityModel)).map(x => NewCacheActor_actor(cache, x))


  println("End of extraction of data \n\n\n========================================================================================================\n\n\n")
  println("Start  of  Dependency  data \n\n\n========================================================================================================\n\n\n")


  getHierarchy(cache, organizationId1)

}
